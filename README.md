# LiblibAiHelper

### 首先说，我不会JS。所有代码都是NewBing写的，我只是微调。欢迎各位大佬指教和改进，我是真的对JS一窍不通。

## 前言

使用过Stable Diffusion WebUI的用户都知道，只下载模型文件是不方便管理的。
最好的做法是将一个同名的txt文件和图片文件和该模型放在同一个目录下，这样在选择模型时就可以看到预览图及它的使用说明。

但是手工做这件事太麻烦了。特别是对于仓鼠病的人来说，下载几千个模型，手动保存图片和说明简直是一种折磨。
所以，在C站下载模型时，我使用了[Civitai网站辅助](https://greasyfork.org/zh-CN/scripts/460557-civitai%E7%BD%91%E7%AB%99%E8%BE%85%E5%8A%A9) 。
它帮助我下载了近1.5T的模型。再配合一系列脚本和管理方法，用起来非常舒服（详见这篇文章：[StableDiffusion模型下载管理最佳实践一条龙](https://zhuanlan.zhihu.com/p/638650568) ）。

然而从最近的趋势来看，L站的模型更新更快，更精美，更符合我的XP。无奈L站并没有一个像Civitai网站辅助一样的工具，所以我之前几乎没有使用L站资源。

我不能一直逃避下去，当然手工操作是更不可能的，于是我在GPT的帮助下，写出了这一个脚本。

这个脚本和Civitai网站辅助类似，可以在下载模型的同时下载它的预览图和保存它的说明文档（txt + HTML）。同时，我还额外保存了该模型的链接。

## 安装方法

油猴脚本需要先安装油猴插件，然后将script.txt中代码复制进去。
或者更简单的方法，从 [这里](https://greasyfork.org/zh-CN/scripts/482082-liblibai-helper) 直接安装。

由于油猴脚本对新用户不友好，所以我也将该脚本转换为Chrome插件，安装很简单：

在浏览器地址栏中输入：chrome://extensions/

如图所示打开开发者模式，点击“Load unpacked”，选择这个chrome目录确定即可。

![chrome_extension.png](doc/chrome_extension.png)

理论上这个插件也能用在Edge上。

## 使用方法

当进入L站的模型下载页面里，该脚本会在“立即生图”按钮下增加三个按钮和一个数字选择框。

![download_button_pos.png](doc/download_button_pos.png)

+ 点击“一键下载”，可以同时下载模型，预览图和说明文档。

+ 点击“仅下载图片”或“仅下载文档”可以单独下载对应内容。

+ 数字选择框用来设置下载预览图的数量限制，默认为10。

一些Tips：

+ 如果页面没有出现上面的控件，可以按F5或点击刷新，重新加载网页。

+ 点击按钮后，请停留在该页面和当前版本的Tab上一段时间，以便让脚本执行完所有操作。

+ 由于浏览器隐私政策，脚本中无法得到下载的文件名，因此我只能将 **模型标题 + "_" + 版本Tab标题** 作为文件名。从结果来看正好与模型的名字一致。

## 更新历史

> 20201214上午更新：修复了下载图片的BUG，增加了选项和功能，可以仅下载图片或文档，并且能指定下载图片的数量。

> 20201214下午更新：修复了识别活动Tab的BUG，并为Chrome插件增加File name sanitizer，以防止模型名中带有特殊字符导致下载出错。

因为我不会JS，并且代码更改需要在油猴和Chrome上分别更新代码和测试，会耗费大量时间。所以原则上能用就不会更新。

